# <span style="color:#C17C43;">EqExecutor</span><span style="font-size: 60%;"><div style="text-align: right;">Developed by userlifeline AND taifun-dairekuto</div></span>

## アプリケーションについて(概要)

このアプリはP2P地震情報 JSON API(以下、P2P JSON API)を使用して、地震情報の更新時に特定ファイルを実行します.
実行条件は情報の種類、観測点・最大震度によって変更でき、実行までの遅延時間を指定することもできます(単位:秒).

## 使用方法

- __起動して放置で問題ありません.__ エラーが発生した場合は、デバッグモードが有効になっている場合にのみ内容が表示されます.  
アクションフォルダ(デフォルト:action)中の実行フォルダ(デフォルト:act1)のフォルダ名に特に指定はありません.  
アクションフォルダに関しては、`act,action,アクション`のフォルダ名でのみ認識されますのでご注意ください.
- 認識は相対パスで行っています. したがって、__実行ファイル(EqExecutor.exe)とアクションフォルダは同じ階層に設置してください.__
- 最小化することでタスクバーに移動します. 通知がある際はタスクバーのアイコンが変化します.
- サーバーへのアクセス制限対策や設定ファイルの破損対策の都合上多重起動はできません.

## 各タブの説明

- ログ
  > ホーム画面です. 現在の状態が随時追記されていきます.
- 実行
  > 実行内容の確認・編集が可能です. 編集はディレクトリ名をクリックすることで行うことができます.  
    また、テストボタンで実行内容をテストすることも可能です.
- 設定
  > P2P JSON APIから受信する間隔、タイムアウトまでの時間を設定することができます.

## 設定の保存

__アプリケーションが終了するときに自動で保存されます.__
実行タブの内容については、情報変更後、「上書き」ボタンを押すことで反映・保存が可能です.

## Q&A

- __Q.__ 情報が取得できません  
  - __A.__ _「要求がタイムアウトしました」_ と表示される場合
      > 情報元のサーバーでIPBANされている可能性があります.  
         P2P地震情報の開発者に相談してください.
  - __A.__ _「リクエストの送信でエラーが発生しました(HTTPREQUEST)」_ と表示される場合
      > インターネットに接続されていない等複数の原因が考えられます.  
         インターネット接続・ファイアーウォール・セキュリティソフトの確認等を行ってみてください.  
         また、タイムアウトの設定秒数を極端に小さくするとこのエラーで取得できない状況を確認してます. そちらの設定も確認してみてください(10秒(=`100000`ミリ秒)程度をおすすめします).
  - __A.__ _「送信中に何かの例外が発生しました...」_ と表示される場合
      > 上記の2つに当てはまらない原因不明のエラーが発生しています.  
        デバッグモードを有効にして詳細を確認した上で開発者([連絡先](#連絡先))にお問い合わせください.

- __Q.__ ファイルが実行されません
  > __A.__ 原因不明のエラーが発生しています.  
    デバッグモードを有効にして詳細を確認した上で開発者([連絡先](#連絡先))にお問い合わせください.

- __Q.__ デバッグモードはどのようにしたら実行できますか？
  > __A.__ デバッグモードは`.\settings\setting.ini`を開き、次のように追記すると適用されます

    ```ruby:setting.ini
    DEBUG=TRUE
    ```

- __Q.__ 「テスト」ボタンを押してテストを実行しようとしたときに「ディレクトリにファイルが存在しません」と表示されます
  > __A.__ 対象ディレクトリに実行ファイル[*1](#1exetxtlnk)がありません.  
    エクスプローラー等で確認して、ファイルを入れるなどの措置をしてください.  
    実際の動作に問題はありません.

- __Q.__ 実行の条件を変更する方法が分かりません
  > __A.__ 「実行」タブを開き、 __変更したいディレクトリ名をクリック__ します.  
    「編集」が変更可能になり、ディレクトリ名の部分が「(ディレクトリ名) について」となれば条件を変更することができます.  
    編集が終了した後、「上書き」ボタンをクリックすることで設定した条件を保存・反映することができます.  
    __「上書き」ボタンを押すのを忘れないようにしてください(条件が反映されない(前の状態で実行されます)ので期待した動作ができない可能性があります).__

- __Q.__ 「P2PMidpoint」とはなんですか？
  - 詳しく教えてください
    > __A.__ 「P2PMidpoint」は私が開発したP2P JSON APIを利用するアプリをほぼ無制限(ユーザーのPCの性能次第)に起動でき、IPBANの可能性をギリギリまで減らすことを目的としたアプリです.  
    情報提供サーバーと利用アプリの仲介を行い、情報の取得を一つにまとめることができます.  
    詳細は[こちら(Twitter)](https://twitter.com/userlifeline/status/1455563898866704384?s=20)をご覧ください.  
    私が開発しているアプリでは今後このアプリを利用することを強く推奨しますのでぜひダウンロードしてください.
  - 設定方法を教えてください
    > __A.__ 「設定」タブの「P2PMidpointを使用する」にチェックを入れます.  
    「ポート」の欄が操作可能になると思うので、P2PMidpointで設定されているポート番号に設定してください(既定値はポート番号12345です).  
    後は放置しておけば自動的にP2PMidpointに接続して情報を取得します.  
    接続に失敗した場合はメッセージを表示してからP2P JSON APIの提供サーバーから直接取得する方式に変更します.

## TIPS

アプリの利用方法についてのアドバイスです.

- __Q.__ 自分の住んでいる地域がなかなか有感にならないのでどのように設定すればいいかわかりません.
  > __A.__ 近くの有感になりやすい(地盤増幅率が大きい)地点を設定しておけばより確実に実行することができます.
- __Q.__ OBS等の録画ソフトで実行する時にどのように設定すればいいか分かりません.
  > __A.__ このアプリはほぼすべての拡張子に対応していますのでいろいろな方法があると思いますが一例を示します.  
  「[sendkeys](https://www.vector.co.jp/soft/win95/net/se250664.html)」というアプリを使います.  
  上のリンクを押してダウンロードした後、「ドキュメント」等の適当な場所に解凍します.  
  次に、解凍してできた「SendKeys.exe」のリンク(ショートカット)を作ります.  
  リンクのプロパティを開き、次のように追記します(リンク先の部分に記述してください). ショートカットキーについては、それぞれの環境で決めてください.  
  作成したリンクをEqExetucorのアクションファイルに入れてください.
  
  ```ruby:SendKeys.lnk
  (半角スペース)"OBS" "(ショートカットキー)"
  
  例) ~\SendKeys.exe "OBS" "[Ctrl][Shift]A"
  ```

  > 次にOBSを起動します.  
  「リプレイバッファ」の設定を有効にして、ホットキーの設定画面を開きます.  
  「リプレイ保存」の項目を探し、キーを設定します. キーは先ほど決めたものを設定してください.  
  OBSの設定を閉じます.  
  リプレイバッファの設定をしたときに時間の設定をしたと思いますのでそれも利用します.  
  EqExecutorを起動します.  
  例えば、600secにリプレイバッファが設定されている場合、該当アクションフォルダの設定を開き、「遅れ」項目の秒数を「300」秒程度に設定します.  
  このように設定した場合、「地震情報が発表されるまでの5分の揺れの動画と発表されてから5分の動画」が撮影されます.  
  このようにして設定を行います. 基本的にOBSのリプレイバッファの秒数の中間の数を遅れの秒数として設定すれば大きな問題(揺れの瞬間が撮れてないなど)は発生しないと思います.

## 更新履歴

それぞれのバージョンの記述した時点での更新履歴・開発状況を掲載します.

- 一般公開バージョン

  |バージョン|更新内容|DATE|VERSION TAG|
  |:--|:--|:-:|:-:|
  |v 0.0.0|-|-|(YET)|

- 限定公開(CANARY)バージョン

  |バージョン|更新内容|DATE|VERSION TAG|
  |:--|:--|:-:|:-:|
  |v 0.0.0|-|2021-10-28|ALPHA|
  |v C0.0.1|・ 観測点を指定した場合、観測点での震度の設定も可能に機能追加<br>・ バージョンを開発者モード「C[*2](#2canary)」に変更[*3](#3v000vc000)|2021-11-02|CANARY-ALPHA|
  |v C0.0.2|共同開発者の許可が取れたためβ公開を開始|2021-11-02|CANARY-BETA|
  |v C0.0.3|・ 感知情報が更新された際等、他の情報が更新されたときにエラーが発生する問題を修正<br>・ 設定ファイル(`.\settings\executeList.csv`)を読み込むときにファイル破損防止のためバックアップを取って読み込む処理に変更<br>・ 情報を変更した際等に正常に情報が設定ファイルに保存されない問題を修正(保存するときに画面が一瞬だけ固まる場合がありますが仕様です.)<br>・ P2PMidpointに対応<br>これにより複数のP2P JSON APIを利用するアプリと同時起動ができるようになりました.<br><br>設定ファイルのバックアップファイルは`.\setting\executeList.csv.eqe`です. <br>内容は.csvと同じですからもし.csvが消えてしまった場合はバックアップファイルの.eqeを消すことで使うことができます.|2021-11-03|CANARY-BETA|
  |v C0.0.3α|v C0.0.3で修正されていなかった「感知情報が更新された際等、他の情報が更新されたときにエラーが発生する問題」を修正|2021-11-04|CANARY-BETA-TEMP|

## 機能追加予定

|案|詳細|予定・結果|バージョン|
|:-:|:--|:-:|:--|
|~~β公開~~|-|2021-11-02 公開済み|v C0.0.2|
|~~P2PMidpointとの連携~~|~~現在開発中のP2P地震情報のデータをより安全に利用できるアプリとの連携~~|2021-11-03 対応済み|v C0.0.3|

## 規約への同意について

このアプリを使うには初回起動時に表示される利用規約に同意する必要があります.
同意しない場合、アプリを利用することはできませんのでご注意ください.  
以下は初回起動時に表示される利用規約の全文です.
> このアプリの利用に関して開発者は一切の責任を負いかねます.  
このアプリを利用したことによってアクセス禁止リストに追加される等の処置に対しても開発者一切の対応を行いません.  
すべて自己責任でお願いします.

## 注意

- アプリケーションの利用規約に関しては「[Lifeline's Appシリーズ 利用規約](https://sites.google.com/view/lifelines-rules/lifelines-app%E3%82%B7%E3%83%AA%E3%83%BC%E3%82%BA-%E5%88%A9%E7%94%A8%E8%A6%8F%E7%B4%84)(第2章-第5条-第1項除く)」、「[Lifeline's Appエンドユーザーライセンス事項](https://sites.google.com/view/lifelines-rules/lifelines-app%E3%82%A8%E3%83%B3%E3%83%89%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%A9%E3%82%A4%E3%82%BB%E3%83%B3%E3%82%B9%E4%BA%8B%E9%A0%85)」、「[プライバシーポリシー](https://sites.google.com/view/lifelines-rules/%E3%83%97%E3%83%A9%E3%82%A4%E3%83%90%E3%82%B7%E3%83%BC%E3%83%9D%E3%83%AA%E3%82%B7%E3%83%BC)」を適用します.
- 詳細な規約については上記3つの規約と情報元のP2P JSON APIの規約に準じます.
- __アプリケーションを実行した時点で各種規約に同意したものとみなします.__
- このアプリを利用したことによるPCの破損・損壊については開発者は一切の責任を負いかねます.
- このアプリの著作権はすべて開発者である生命線と共同開発者であるtaifun-dairekutoにあります.
- このアプリはP2P JSON APIを利用しています.  
  __他のP2P JSON APIを利用するアプリと複数同時起動をするとアクセス過多でIPBANされる可能性がありますので十分ご注意ください.__[*](https://github.com/p2pquake/epsp-specifications/blob/master/json-api-v1.md#%E8%A3%9C%E8%B6%B3%E4%BA%8B%E9%A0%85)  
  __この問題については私が開発している「P2PMidpoint」を利用することで対処することができます.__ [Q&A](#qa)でこれについて記載しています.
- このアプリは情報の取得についてはCC BY 4.0準拠であり、情報は[気象庁](https://www.jma.go.jp)のものを変形利用しています.
- P2PMidpointとの接続は`localhost`を通して行っています. 接続時にポートを消費しています.

## SPECIAL THANKS

### アプリ提案・開発支援・共同開発者

> taifun-dairekuto様 [Twitter](https://twitter.com/taifun_dairekut)

## THANKS

### 情報提供

- 情報取得元
  > 気象庁
- P2P地震情報開発者
  > たくや様 [Twitter](https://twitter.com/p2pquake_takuya)
- デバッガー
  > デバッガーサーバー「Lifeline's App」に参加されている方々

### その他支援してくださった方々

## 連絡先

いずれかから連絡してください. 件名を書いていただけると幸いです.

- Twitter : [@userlifeline](https://twitter.com/userlifeline)
- Discord : ``生命線#7696``
- デバッグサーバー(Discord) : [参加する](https://discord.gg/EEvB7YquPx)

## ドキュメントの更新履歴

- 2021-11-01 作成
- 2021-11-02 更新 (バージョン情報などなど追加)
- 2021-11-03 更新 (いろいろ更新したので詳細書くのはやめておきます)

> このアプリが皆さまの地震監視・観測に利用していただけると願って.  
Copyright 2021 userlifeline AND taifun-dairekuto, ALL RIGHTS RESERVED.

### 注釈

#### *1:exe,txt,lnk...

#### *2:Canary

#### *3:v 0.0.0=v C0.0.0
